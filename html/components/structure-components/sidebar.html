<style>
    #image-upload {
      display: none;
    }
    #image-upload-label {
      background-color: #007bff;
      color: #fff;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      display: inline-block;
    }
  </style>

<script type="module">    
document.getElementById('submit-btn').addEventListener('click', function() {
  const files = document.getElementById('image-upload').files;
  //console.log(files);
  const promises = [];

  for (let i = 0; i < files.length; i++) {
    const promise = imageFileToBufferArray(files[i]);
    promises.push(promise);
  }

  Promise.all(promises)
    .then(bufferArrays => {
      for (let i = 0; i < bufferArrays.length; i++) {
        console.log(generateImageJSON(12, extractImageDate(files[i]), "no description", bufferArrays[i]));
      }
    })
    .catch(error => {
      console.error('Error:', error.message);
    });
});

function extractImageDate(file) {
    return new Date(file.lastModified);
}

function imageFileToBufferArray(image) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = function(event) {
      const buffer = event.target.result;
      resolve(buffer);
    };
    reader.onerror = function(error) {
      reject(error);
    };
    reader.readAsArrayBuffer(image);
  });
}

function generateImageJSON(ID="No image ID", date='No date', description='No description', image=new ArrayBuffer()) {
  let returner = {
    id: ID,
    date: date,
    description: description,
    image: image,
  };
  return returner;
}
</script>

<div class="sidebar">
    <!--div class="inverted-border-radius"></div-->
    <div class="sidebar-background"></div>
    <div class="contents">
        <button class="sidebar-tab clicked" type="button">Home</button>
        <button class="sidebar-tab" type="button">Profile</button>
    </div>
    <span>
        <input type="file" id="image-upload" accept="image/jpeg, image/png" multiple>
        <label for="image-upload" id="image-upload-label">Select Images</label>
        <button id="submit-btn">Submit</button>
    </span>
</div>

<div class="sidebar-mobile">
    <!--div class="inverted-border-radius"></div-->
    <div class="sidebar-background"></div>
    <div class="contents">
        <button class="home" type="button">
            <img src="/files/home.png" height="50" weight="50">
        </button>
        <button class="profile" type="button">
            <img src="/files/profile.png" height="40" weight="40">
        </button>
    </div>
</div>

<script src="/js/sidebar.js"></script>
<script>
    xLuIncludeFile();
</script>